<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Prisoner's Dilemma Tournament</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <header class="hero">
    <div class="container">
      <h1>Iterated Prisoner's Dilemma Tournament</h1>
      <p class="subtitle">Experiment with classic strategies and visualize the results in real time.</p>
      <div class="hero-actions">
        <button type="button" class="cta" id="startFormCta">Start a tournament</button>
        <p class="hero-hint">Pick the programs you want to pit against each other, configure the rules, and watch the standings update instantly.</p>
      </div>
    </div>
  </header>

  <main class="container layout">
    <section class="card" id="configCard">
      <h2>Configure tournament</h2>
      <form id="tournamentForm">
        <div class="grid">
          <label>
            Rounds
            <input type="number" name="rounds" min="1" value="150" required>
          </label>
          <label>
            Continuation probability
            <input type="number" name="continuation" min="0" max="1" step="0.01" value="0">
          </label>
          <label>
            Noise probability
            <input type="number" name="noise" min="0" max="1" step="0.01" value="0">
          </label>
          <label>
            Repeats
            <input type="number" name="repeats" min="1" value="1" required>
          </label>
          <label>
            Seed (optional)
            <input type="number" name="seed" placeholder="random">
          </label>
        </div>

        <fieldset class="strategies">
          <legend>Strategies</legend>
          <div class="strategy-actions">
            <button type="button" id="selectAll">Select all</button>
            <button type="button" id="clearAll">Clear</button>
          </div>
          <p class="strategy-meter">
            <span><strong id="strategyCounter">0</strong> selected</span>
            <span class="divider" aria-hidden="true">•</span>
            <span><span id="strategyTotal">0</span> available programs</span>
          </p>
          <div id="strategiesList" class="strategy-list" aria-live="polite">
            <p class="loading">Loading strategies…</p>
          </div>
        </fieldset>

        <fieldset class="payoffs">
          <legend>Payoff matrix</legend>
          <div class="grid payoff-grid">
            <label>Temptation (T)
              <input type="number" name="payoff_T" value="5">
            </label>
            <label>Reward (R)
              <input type="number" name="payoff_R" value="3">
            </label>
            <label>Punishment (P)
              <input type="number" name="payoff_P" value="1">
            </label>
            <label>Sucker (S)
              <input type="number" name="payoff_S" value="0">
            </label>
          </div>
        </fieldset>

        <fieldset class="media-config" aria-describedby="mediaLimitNote">
          <legend>Media network</legend>
          <p class="hint">Choose which outlets broadcast match outcomes and which strategies subscribe to them.</p>
          <div class="media-grid">
            <section class="media-outlets">
              <h3>Outlets</h3>
              <div id="mediaOutlets" class="media-outlet-list" aria-live="polite">
                <p class="loading">Loading media configuration…</p>
              </div>
            </section>
            <section class="media-subscriptions">
              <h3>Subscriptions</h3>
              <p id="mediaLimitNote" class="hint media-note">Loading…</p>
              <div class="table-wrapper">
                <table id="mediaSubscriptionsTable">
                  <thead>
                    <tr>
                      <th scope="col">Strategy</th>
                      <th scope="col">Subscribed outlets</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td colspan="2" class="hint">Select strategies to configure subscriptions.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>
        </fieldset>

        <div class="actions">
          <button type="submit" id="runButton">Run tournament</button>
        </div>
      </form>
    </section>

    <section class="card" id="resultsCard">
      <h2>Results</h2>
      <p id="statusMessage" class="status">Pick some strategies and press “Run tournament”.</p>
      <div id="results" class="hidden" aria-live="polite">
        <div class="summary">
          <div>
            <strong>Strategies:</strong>
            <span id="summaryStrategies"></span>
          </div>
          <div>
            <strong>Rounds per match:</strong>
            <span id="summaryRounds"></span>
          </div>
          <div>
            <strong>Repeats:</strong>
            <span id="summaryRepeats"></span>
          </div>
          <div>
            <strong>Top program:</strong>
            <span id="summaryTopStrategy">—</span>
          </div>
          <div>
            <strong>Media reports delivered:</strong>
            <span id="summaryMediaReports">0</span>
          </div>
        </div>

        <section class="chart" aria-label="Average score per round by program">
          <h3>Performance overview</h3>
          <div id="standingsChart" class="chart-body"></div>
        </section>

        <div class="tables">
          <div class="table-wrapper">
            <h3>Standings</h3>
            <table id="standingsTable">
              <thead>
                <tr>
                  <th scope="col">Rank</th>
                  <th scope="col">Strategy</th>
                  <th scope="col">Total score</th>
                  <th scope="col">Total rounds</th>
                  <th scope="col">Avg / round</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="table-wrapper">
            <h3>Match breakdown</h3>
            <table id="matchesTable">
              <thead>
                <tr>
                  <th scope="col">Rep</th>
                  <th scope="col">A</th>
                  <th scope="col">B</th>
                  <th scope="col">Score A</th>
                  <th scope="col">Score B</th>
                  <th scope="col">Avg A</th>
                  <th scope="col">Avg B</th>
                  <th scope="col">Rounds</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <p class="hint" id="matchHint"></p>
          </div>
          <div class="table-wrapper">
            <h3>Media reports</h3>
            <table id="mediaTable">
              <thead>
                <tr>
                  <th scope="col">Strategy</th>
                  <th scope="col">Outlet</th>
                  <th scope="col">Rep</th>
                  <th scope="col">Match</th>
                  <th scope="col">Accurate</th>
                  <th scope="col">Rumor</th>
                  <th scope="col">Delay</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <p class="hint" id="mediaHint"></p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <p>Built with Flask &amp; vanilla JavaScript. Source available in this repository.</p>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='app.js') }}" defer></script>
</body>
</html>
